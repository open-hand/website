+++
title = "流水线"
description = ""
weight = 3
+++

# 流水线

## 1. 概述

流水线是一种实现任务流程自动化、可视化的方式，用户可在此页面预设流水线中的各个阶段与任务，使整个流程更加高效。在流水线的每个阶段中，支持多任务的并行执行和串行执行，真正实现流水线任务的无缝集成。此外，人工卡点的任务又可使整条流水线的进度随时处于人工监控之下。

您可在流水线管理页面对流水线进行创建与管理的操作。

## 2. 查看流水线

在流水线主界面，您可以通过列表，查看到流水线的状态、触发方式、名称、创建者以及更新时间；用户可通过列表上方的筛选框，快速筛选出待我审核的、我审核过的以及我执行过的所有流水线记录。

![image](/docs/user-guide/deploy/app-deploy/images/pipeline-01.png)

## 3. 流水线管理

### 3.1 创建流水线

1. 点击页面左上方的`创建流水线 `，进入创建流水线页面。

    ![image](/docs/user-guide/deploy/app-deploy/images/pipeline-02.png)
 
2. 填写`流水线名称`，此处名称在项目下唯一；
 
3. 选择`触发方式`，可选自动触发与手动触发；  
 
    - 自动触发：满足所有触发条件时，该流水线才会自动执行。若选择自动触发，则该流水线中阶段一的任务一便不能选择为人工卡点。  
        - 只有满足流水线中所有触发条件时，流水线才会自动执行；即流水线中存在多个部署任务时，需要满足其中所有部署任务的触发条件（生成对应的版本），流水线才会自动执行。
    - 手动触发：需要手动点击执行，才能触发流水线。若选择手动触发，则需要为该流水线选择触发人员（可多选），只有被选中的人员才有权限执行该流水线。若流水线中含有部署任务，则要求触发人员必须拥有部署任务对应环境的权限。
        - 只有满足流水线中所有触发条件时，才能手动执行该流水线；即流水线中存在多个部署任务时，需要满足其中所有部署任务的触发条件（生成对应的版本），才能点击执行流水线。
        <blockquote class="note"> 
            触发人员若无其中任何一个环境的部署权限，则不能触发。
        </blockquote>

4. 添加阶段；点击阶段之间的添加按钮，即可成功添加一个阶段；点击某个阶段的名称，会弹出修改界面，支持修改该阶段的名称，设置阶段之间的流转方式，若选择手动流转，需要为此设置审核人员（可多选，且默认为其中一个人员审核通过则该任务通过，第一个审核人员点击中止则该任务中止）；点击阶段内的删除按钮，确认后，便能删除此阶段；  

5. 任务设置；在每个阶段下，需要选择设置对应阶段中任务的执行方式。分别是：任务串行与任务并行，其中任务串行是指阶段中的所有任务从上至下依次执行；并行是指阶段中所有任务同时执行，但阶段中任务并行时，此阶段中便不能添加人工卡点的任务。  
    - 只有当一个阶段中的所有任务均执行成功后，才能进入下一阶段。

6. 添加任务；点击对应阶段下的`添加任务`，会从右侧弹出任务添加框，首先需要选择任务类型，目前可选人工卡点或部署； 
    
    - 人工卡点：人工审核的任务；

        （1）选择人工卡点任务类型后，需要填写任务名称；

        （2）选择审核人员（可多选）;

        （3）最后选择审核模式，其中包括会签和或签。

            会签是指所选的审核人员全部审核通过后才算通过，其中有一人选择中止，则此任务中止；或签是指所选的审核人员中，一人审核通过后此任务便通过，一人选择中止则此任务中止，以其中第一个审核人员的审核结果为准。

    - 部署：通过预设应用部署所需的元素，实现部署自动化；

        （1）选择部署任务类型后，需填写任务名称；

        （2）选择项目下的任一`应用服务`；

        （3）输入或选择`服务版本类型`(此处可以选择我们给出的版本类型或手动输入自定义的版本类型。若不填写此栏，则默认自动部署该应用服务的所有版本)；

        （4）选择`环境`，且只可选择运行中的环境；

        （5）选择`部署模式`（部署模式有新建实例和替换实例两种）；

        （6） 选择`部署配置`, 此处会根据您选的应用服务与环境自动匹配所有关联的部署配置，您可根据给出的配置信息进行选择。若所选应用服务与环境暂无对应的部署配置，则需要在部署配置页面创建一个对应的部署配置。
            
            若修改了给出的配置信息后，所选部署配置中的配置信息也将随之改动。同时，若部署配置中的配置信息被修改后，那么流水线中已选择该部署配置的部署任务在之后的自动部署时，会直接使用最新的部署配置。

### 3.2 修改流水线

点击某条流水线的名称，会从右侧弹出流水线的修改界面。

此界面支持修改流水线的触发人员（此处为人工触发类型流水线的触发人员）、流水线中的各个阶段与任务。 

![image](/docs/user-guide/deploy/app-deploy/images/pipeline-03.png)

<blockquote class="note"> 
若流水线中包含了部署任务，则只有拥有所有部署任务对应的环境权限的成员才能编辑该条流水线。
        </blockquote>

### 3.3 停用/启用流水线

- 在流水线列表中选择一个启用状态的流水线，点击名称后面的![image](https://minio.choerodon.com.cn/knowledgebase-service/file_d48e2094e69a44639014292d664b9de0_blob.png)图标，选择停用，即可停用流水线。
    若流水线已停用，则仅能进行以下操作：查看执行详情；启用；删除。

- 在流水线列表中选择一个停用状态的流水线，点击名称后面的![image](https://minio.choerodon.com.cn/knowledgebase-service/file_d48e2094e69a44639014292d664b9de0_blob.png)图标，选择启用，即可启用流水线。

<blockquote class="note"> 
    只有项目所有者可以停用/启用流水线。
        </blockquote>

### 3.4 删除流水线

- 在流水线列表中选择一个流水线，点击名称后面的![image](https://minio.choerodon.com.cn/knowledgebase-service/file_d48e2094e69a44639014292d664b9de0_blob.png)图标，选择删除，即可删除流水线。

### 3.5 执行人工触发流水线

在流水线的主界面的列表中，选择一个人工触发类型的流水线，点击名称后面的![image](https://minio.choerodon.com.cn/knowledgebase-service/file_d48e2094e69a44639014292d664b9de0_blob.png)图标，选择执行操作，会跳转至部署记录界面，看到这条流水线已经开始执行。

<blockquote class="note"> 
 只有人工触发类型的流水线才能被手动执行，且只有流水线中指定的触发人员才有权限执行。点击执行后，只有满足流水线执行条件后（部署任务需要生成对应的触发版本），流水线才会执行。
        </blockquote>

## 4. 阅读更多

- [部署](../deploy)
- [资源管理](../resource)
- [环境配置](../../env-config)