+++
title = "任务管理"
weight = 60
description = "用于对平台中任务的管理"
+++

# 任务管理

## 1. 概要

任务，按时间点或者周期性执行的任务。它实现了任务执行程序和触发器之间的关联。一个具体的任务，配置任务的触发时间，调度器会根据触发时间规则来安排执行此任务。

![任务](/docs/user-guide/manager-guide/image/job.jpg)

## 2. 任务列表

列表字段：

- 名称：任务名称，具有唯一性，用户自定义。
- 描述：用户对任务功能的自定义说明。
- 上次执行时间：任务上一次执行的实际时间。
- 下次执行时间：任务下一次执行的计划时间。
- 状态：任务的运行状态。共有`进行中`、`完成`、`失败`三种状态。

## 3. 创建任务

1. 进入平台管理，点击菜单“管理>任务管理”，进入任务管理页面。
2. 点击操作栏的`创建任务`→![创建任务](/docs/user-guide/manager-guide/image/create.png)，创建一个任务。
3. 输入`任务名称`、`任务描述`。
4. 选择`开始时间`、`结束时间`。结束时间不能早于开始时间。
5. 选择`触发类型`。我们提供两种任务触发类型:`简单任务`、`Cron任务`。
    - 简单任务： 当需要在规定的时间执行一次或在规定的时间段以一定的时间间隔重复触发执行Job时，SimpleTrigger就可以满足要求； 

    - Cron任务： 支持比 SimpleTrigger 更具体的调度，而且也不是很复杂。基于 cron 表达式，CronTrigger 支持类似日历的重复间隔，而不是单一的时间间隔。

6. 输入任务执行的触发时间规则。

    - 如果是`简单任务`，则输入`重复间隔`、`重复次数`。 

    - 如果是`Cron任务`,则输入`cron表达式`。

        您可以点击cron表达式解析按钮→![解析表达式](/docs/user-guide/manager-guide/image/cron.png)对cron表达式进行解析。点击了解[如何cron表达式](#cron)

7. 选择超时策略，超时策略有`阻塞`、`串行`、`并行`三种。

    - 选择阻塞：一个任务的一次执行开始时，上一次执行尚未完成，则将此任务暂停。
    - 选择串行：一个任务的一次执行开始时，上一次执行尚未完成，则等待上一次执行完成后立即开始本次执行。
    - 选择并行：一个任务的一次执行开始时，上一次执行尚未完成，则上次执行和本次执行一起进行。

8. 选择`任务程序`。

9. 编辑对应任务程序的参数。当不更改参数时，默认使用默认值。

10. 选择通知对象。

11. 点击下一步，预览任务详情。点击创建，完成任务的创建。

## 4. 查看任务详情

1. 进入平台管理，点击菜单“管理>任务管理”，进入任务管理页面。

2. 点击任务的名称,进入到任务详情页面。

您可以在任务详情页查看`任务信息`和`任务日志`。
通过`任务信息`，您可以了解`任务名称`，`任务描述`，起止时间，`触发类型`，触发时间规则，执行策略，`上次执行时间`，`下次执行时间`，`任务程序名`，任务参数详情，通知对象。
通过`任务日志`，你可以了解任务执行的`状态`，`实例ID`，`计划执行时间`和`实际执行时间`。

## 5. 启停用任务

- 在任务管理列表页，点击您要停用任务所在列的![三点](/docs/user-guide/manager-guide/image/more-vert.png)按钮，选择`停用`，停用该任务，任务停用后便不会执行。 
- 在任务管理列表页，点击您要停用任务所在列的![三点](/docs/user-guide/manager-guide/image/more-vert.png)按钮，选择`启用`，启用该任务。

## 6. 删除任务

- 在任务管理列表页，点击您要删除任务所在列的![三点](/docs/user-guide/manager-guide/image/more-vert.png)按钮，选中`删除`，即可删除任务。

## 7. cron表达式填写说明

<div id="cron"></div>

### 表达式结构

Cron表达式,用于配置cronTrigger实例的触发时间规则是一个字符串，字符串以5或6个空格隔开，分为6或7个域，每一个域代表一个含义，语法格式如下：  

>{秒数} {分钟} {小时} {日期} {月份} {星期} {年份(可为空)} 

>例：  "0 0 12 ? * WED" 在每星期三下午12:00 执行（年份通常 省略）

### 各字段及符号含义

cron表达式包含的必要组件：

位置 | 字段 | 允许值 | 允许的特殊字符
:---:|:---|:---|:---
1|秒（Seconds）|0~59的整数|	, - * /  四个字符
2|分（Minutes）|0~59的整数|	, - * /  四个字符
3|时（Hours）|0~23的整数|, - * /  四个字符
4|日期（DayofMonth）	|1~31的整数(根据实际情况而定)|,- * ? / L W C 八个字符
5|月（Month）|1~12的整数或者 JAN-DEC|, - * / 四个字符
6|周（DayofWeek）|1~7的整数或者 SUN-SAT （1=SUN）|, - * ? / L C # 八个字符
7|年(可选，留空)（Year）|1970~2099|, - * /  四个字符

特殊符号的含义：

特殊字符 | 说明
:---|:---
*|通配符，任意值
?|无特定值。通常和其他指定的值一起使用，表示必须显示该值但不能检查
-|范围。e.g.小时部分10-12表示10:00，11:00， 12:00
,|列分隔符。可以让你指定一系列的值。e.g.在星期域中指定MON、TUE和WED
/|增量。表示一个值的增量，e.g.分钟域中0/1表示从0开始，每次增加1min
L|表示Last。它在日期和星期域中表示有所不同。在日期域中，表示这个月的最后一天，而在星期域中，它永远是7（星期六）。当你希望使用星期中某一天时，L字符非常有用。e.g.星期域中6L表示每一个月的最后一个星期五
W|在本月内离当天最近的工作日触发，所谓的最近工作日，即当天到工作日的前后最短距离，如果当天即为工作日，则距离是0；所谓本月内指的是不能跨月取到最近工作日，即使前/后月份的最后一天/第一天确实满足最近工作日。e.g. LW表示本月的最后一个工作日触发，W强烈依赖月份。
#|表示该月的第几个星期，e.g. 1#2表示每一个月的第一个星期一
C|日历值。日期值是根据一个给定的日历计算出来的。在日期域中给定一个20C将在20日（日历包括20日）或20日后日历中包含的第一天（不包括20日）激活触发器。例如在一个星期域中使用6C表示日历中星期五（日历包括星期五）或者第一天（日历不包括星期五）

### Cron 表达式案例

*/5 * * * * ? 每隔5秒执行一次  
0 */1 * * * ? 每隔1分钟执行一次  
0 0 5-15 * * ? 每天5-15点整点触发  
0 0/3 * * * ? 每三分钟触发一次  
0 0-5 14 * * ? 在每天下午2点到下午2:05期间的每1分钟触发   
0 0/5 14 * * ? 在每天下午2点到下午2:55期间的每5分钟触发  
0 0/5 14,18 * * ? 在每天下午2点到2:55期间和下午6点到6:55期间的每5分钟触发  
0 0/30 9-17 * * ? 朝九晚五工作时间内每半小时  
0 0 10,14,16 * * ? 每天上午10点，下午2点，4点   

0 0 12 ? * WED 表示每个星期三中午12点  
0 0 17 ? * TUES,THUR,SAT 每周二、四、六下午五点  
0 10,44 14 ? 3 WED 每年三月的星期三的下午2:10和2:44触发   
0 15 10 ? * MON-FRI 周一至周五的上午10:15触发  

0 0 23 L * ? 每月最后一天23点执行一次    
0 15 10 ? * 6L 每月的最后一个星期五上午10:15触发   
0 15 10 * * ? 2005 2005年的每天上午10:15触发   
0 15 10 ? * 6L 2002-2005 2002年至2005年的每月的最后一个星期五上午10:15触发   
0 15 10 ? * 6#3 每月的第三个星期五上午10:15触发  

"30 * * * * ?" 每半分钟触发任务  
"30 10 * * * ?" 每小时的10分30秒触发任务  
"30 10 1 * * ?" 每天1点10分30秒触发任务  
"30 10 1 20 * ?" 每月20号1点10分30秒触发任务  
"30 10 1 20 10 ? *" 每年10月20号1点10分30秒触发任务  
"30 10 1 ? 10 SUN 2018" 2018年10月每周日1点10分30秒触发任务  
"15,30,45 * * * * ?" 每15秒，30秒，45秒时触发任务  
"15-45 * * * * ?" 15到45秒内，每秒都触发任务  
"15/5 * * * * ?" 每分钟的每15秒开始触发，每隔5秒触发一次  
"15-30/5 * * * * ?" 每分钟的15秒到30秒之间开始触发，每隔5秒触发一次  
"0 0/3 * * * ?" 每小时的第0分0秒开始，每三分钟触发一次  
"0 15 10 ? * MON-FRI" 星期一到星期五的10点15分0秒触发任务  

## 8. 更多操作

- [事务定义](../saga/saga-define)
- [事务实例](../saga/saga-instance)